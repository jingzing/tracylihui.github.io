
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Openstack_Havana_Install_Guide_MutilNode | 李大辉</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Ｔracylihui">
    

    
    <meta name="description" content="==========================================================
  OpenStack Havana 安装指南:Version: 1.0:Source: https://github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode:Keywords: 多点Open">
<meta property="og:type" content="article">
<meta property="og:title" content="Openstack_Havana_Install_Guide_MutilNode">
<meta property="og:url" content="http://yoursite.com/2015/09/28/openstack/Openstack_Havana_Install_Guide_MutilNode/index.html">
<meta property="og:site_name" content="李大辉">
<meta property="og:description" content="==========================================================
  OpenStack Havana 安装指南:Version: 1.0:Source: https://github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode:Keywords: 多点Open">
<meta property="og:updated_time" content="2015-09-28T02:04:48.807Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Openstack_Havana_Install_Guide_MutilNode">
<meta name="twitter:description" content="==========================================================
  OpenStack Havana 安装指南:Version: 1.0:Source: https://github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode:Keywords: 多点Open">

    
    <link rel="alternative" href="/atom.xml" title="李大辉" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="李大辉" title="李大辉"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="李大辉">李大辉</a></h1>
				<h2 class="blog-motto">给自己提供一个总结的平台</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/summary">知识点总结</a></li>
					
						<li><a href="/problems">Bug汇总</a></li>
					
						<li><a href="/archives">文章</a></li>
					
						<li><a href="/about">简历</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/28/openstack/Openstack_Havana_Install_Guide_MutilNode/" title="Openstack_Havana_Install_Guide_MutilNode" itemprop="url">Openstack_Havana_Install_Guide_MutilNode</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Ｔracylihui" target="_blank" itemprop="author">Ｔracylihui</a>
		
  <p class="article-time">
    <time datetime="2015-09-28T02:01:14.000Z" itemprop="datePublished"> 发表于 2015-09-28</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenStack_Havana_安装指南"><span class="toc-number">1.</span> <span class="toc-text">  OpenStack Havana 安装指南</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#作者"><span class="toc-number">2.</span> <span class="toc-text">作者</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内容列表"><span class="toc-number">3.</span> <span class="toc-text">内容列表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0-_简介"><span class="toc-number">4.</span> <span class="toc-text">0. 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-_环境搭建"><span class="toc-number">5.</span> <span class="toc-text">1. 环境搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-_控制节点"><span class="toc-number">6.</span> <span class="toc-text">2. 控制节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-_准备Ubuntu"><span class="toc-number">6.1.</span> <span class="toc-text">2.1. 准备Ubuntu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-设置网络"><span class="toc-number">6.2.</span> <span class="toc-text">2.2.设置网络</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Not_internet_connected(used_for_OpenStack_management)"><span class="toc-number">7.</span> <span class="toc-text">Not internet connected(used for OpenStack management)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For_Exposing_OpenStack_API_over_the_internet"><span class="toc-number">8.</span> <span class="toc-text">For Exposing OpenStack API over the internet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-_安装MySQL"><span class="toc-number">8.1.</span> <span class="toc-text">2.3. 安装MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-_安装RabbitMQ和NTP"><span class="toc-number">8.2.</span> <span class="toc-text">2.4. 安装RabbitMQ和NTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-_创建数据库"><span class="toc-number">8.3.</span> <span class="toc-text">2.5. 创建数据库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Keystone"><span class="toc-number">9.</span> <span class="toc-text">Keystone</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Glance"><span class="toc-number">10.</span> <span class="toc-text">Glance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Neutron"><span class="toc-number">11.</span> <span class="toc-text">Neutron</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nova"><span class="toc-number">12.</span> <span class="toc-text">Nova</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cinder"><span class="toc-number">13.</span> <span class="toc-text">Cinder</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-_配置Keystone"><span class="toc-number">13.1.</span> <span class="toc-text">2.6. 配置Keystone</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#注意在执行脚本前请按你的网卡配置修改HOST_IP和HOST_IP_EXT"><span class="toc-number">14.</span> <span class="toc-text">注意在执行脚本前请按你的网卡配置修改HOST_IP和HOST_IP_EXT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Paste_the_following:"><span class="toc-number">15.</span> <span class="toc-text">Paste the following:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Load_it:"><span class="toc-number">16.</span> <span class="toc-text">Load it:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-_设置Glance"><span class="toc-number">16.1.</span> <span class="toc-text">2.7. 设置Glance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-_设置Neutron"><span class="toc-number">16.2.</span> <span class="toc-text">2.8. 设置Neutron</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_database_section"><span class="toc-number">17.</span> <span class="toc-text">Under the database section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_OVS_section"><span class="toc-number">18.</span> <span class="toc-text">Under the OVS section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Firewall_driver_for_realizing_neutron_security_group_function"><span class="toc-number">19.</span> <span class="toc-text">Firewall driver for realizing neutron security group function</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-_设置Nova"><span class="toc-number">19.1.</span> <span class="toc-text">2.9. 设置Nova</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Workaround_for_https://bugs-launchpad-net/nova/+bug/1154809"><span class="toc-number">20.</span> <span class="toc-text">Workaround for https://bugs.launchpad.net/nova/+bug/1154809</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Auth"><span class="toc-number">21.</span> <span class="toc-text">Auth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Imaging_service"><span class="toc-number">22.</span> <span class="toc-text">Imaging service</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vnc_configuration"><span class="toc-number">23.</span> <span class="toc-text">Vnc configuration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Network_settings"><span class="toc-number">24.</span> <span class="toc-text">Network settings</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Neutron_+_Nova_Security_groups"><span class="toc-number">25.</span> <span class="toc-text">If you want Neutron + Nova Security groups</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#firewall_driver=nova-virt-firewall-NoopFirewallDriver"><span class="toc-number">26.</span> <span class="toc-text">firewall_driver=nova.virt.firewall.NoopFirewallDriver</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security_group_api=neutron"><span class="toc-number">27.</span> <span class="toc-text">security_group_api=neutron</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Nova_Security_groups_only,_comment_the_two_lines_above_and_uncomment_line_-1-"><span class="toc-number">28.</span> <span class="toc-text">If you want Nova Security groups only, comment the two lines above and uncomment line -1-.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Metadata"><span class="toc-number">29.</span> <span class="toc-text">Metadata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Compute"><span class="toc-number">30.</span> <span class="toc-text">Compute</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cinder-1"><span class="toc-number">31.</span> <span class="toc-text">Cinder</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-10-_设置Cinder"><span class="toc-number">31.1.</span> <span class="toc-text">2.10. 设置Cinder</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#osapi_volume_listen_port=5900"><span class="toc-number">32.</span> <span class="toc-text">osapi_volume_listen_port=5900</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Type_in_the_followings:"><span class="toc-number">33.</span> <span class="toc-text">Type in the followings:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-11-_设置Horizon"><span class="toc-number">33.1.</span> <span class="toc-text">2.11. 设置Horizon</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-_网络节点"><span class="toc-number">34.</span> <span class="toc-text">3. 网络节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-_准备节点"><span class="toc-number">34.1.</span> <span class="toc-text">3.1. 准备节点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Comment_the_ubuntu_NTP_servers"><span class="toc-number">35.</span> <span class="toc-text">Comment the ubuntu NTP servers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set_the_network_node_to_follow_up_your_conroller_node"><span class="toc-number">36.</span> <span class="toc-text">Set the network node to follow up your conroller node</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-_配置网络"><span class="toc-number">36.1.</span> <span class="toc-text">3.2. 配置网络</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenStack_management"><span class="toc-number">37.</span> <span class="toc-text">OpenStack management</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VM_internet_Access"><span class="toc-number">38.</span> <span class="toc-text">VM internet Access</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-_OpenVSwitch"><span class="toc-number">38.1.</span> <span class="toc-text">3.3. OpenVSwitch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_file_describes_the_network_interfaces_available_on_your_system"><span class="toc-number">39.</span> <span class="toc-text">This file describes the network interfaces available on your system</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and_how_to_activate_them-_For_more_information,_see_interfaces(5)-"><span class="toc-number">40.</span> <span class="toc-text">and how to activate them. For more information, see interfaces(5).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_loopback_network_interface"><span class="toc-number">41.</span> <span class="toc-text">The loopback network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Not_internet_connected(used_for_OpenStack_management)-1"><span class="toc-number">42.</span> <span class="toc-text">Not internet connected(used for OpenStack management)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_primary_network_interface"><span class="toc-number">43.</span> <span class="toc-text">The primary network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_is_an_autoconfigured_IPv6_interface"><span class="toc-number">44.</span> <span class="toc-text">This is an autoconfigured IPv6 interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#iface_eth0_inet6_auto"><span class="toc-number">45.</span> <span class="toc-text">iface eth0 inet6 auto</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For_Exposing_OpenStack_API_over_the_internet-1"><span class="toc-number">46.</span> <span class="toc-text">For Exposing OpenStack API over the internet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-_Neutron-*"><span class="toc-number">46.1.</span> <span class="toc-text">3.4. Neutron-*</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_database_section-1"><span class="toc-number">47.</span> <span class="toc-text">Under the database section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_OVS_section-1"><span class="toc-number">48.</span> <span class="toc-text">Under the OVS section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Firewall_driver_for_realizing_neutron_security_group_function-1"><span class="toc-number">49.</span> <span class="toc-text">Firewall driver for realizing neutron security group function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_Neutron_user_information_for_accessing_the_Neutron_API-"><span class="toc-number">50.</span> <span class="toc-text">The Neutron user information for accessing the Neutron API.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IP_address_used_by_Nova_metadata_server"><span class="toc-number">51.</span> <span class="toc-text">IP address used by Nova metadata server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP_Port_used_by_Nova_metadata_server"><span class="toc-number">52.</span> <span class="toc-text">TCP Port used by Nova metadata server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#确保RabbitMQ_IP指向了控制节点"><span class="toc-number">53.</span> <span class="toc-text">确保RabbitMQ IP指向了控制节点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-_计算节点"><span class="toc-number">54.</span> <span class="toc-text">4. 计算节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-_准备节点"><span class="toc-number">54.1.</span> <span class="toc-text">4.1. 准备节点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Comment_the_ubuntu_NTP_servers-1"><span class="toc-number">55.</span> <span class="toc-text">Comment the ubuntu NTP servers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set_the_network_node_to_follow_up_your_conroller_node-1"><span class="toc-number">56.</span> <span class="toc-text">Set the network node to follow up your conroller node</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-_配置网络"><span class="toc-number">56.1.</span> <span class="toc-text">4.2. 配置网络</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_file_describes_the_network_interfaces_available_on_your_system-1"><span class="toc-number">57.</span> <span class="toc-text">This file describes the network interfaces available on your system</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and_how_to_activate_them-_For_more_information,_see_interfaces(5)--1"><span class="toc-number">58.</span> <span class="toc-text">and how to activate them. For more information, see interfaces(5).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_loopback_network_interface-1"><span class="toc-number">59.</span> <span class="toc-text">The loopback network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Not_internet_connected(used_for_OpenStack_management)-2"><span class="toc-number">60.</span> <span class="toc-text">Not internet connected(used for OpenStack management)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_primary_network_interface-1"><span class="toc-number">61.</span> <span class="toc-text">The primary network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VM_Configuration"><span class="toc-number">62.</span> <span class="toc-text">VM Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-_KVM"><span class="toc-number">62.1.</span> <span class="toc-text">4.3. KVM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-_OpenVSwitch"><span class="toc-number">62.2.</span> <span class="toc-text">4.4. OpenVSwitch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#br-int_will_be_used_for_VM_integration"><span class="toc-number">63.</span> <span class="toc-text">br-int will be used for VM integration</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-_Neutron"><span class="toc-number">63.1.</span> <span class="toc-text">4.5. Neutron</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_database_section-2"><span class="toc-number">64.</span> <span class="toc-text">Under the database section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_OVS_section-2"><span class="toc-number">65.</span> <span class="toc-text">Under the OVS section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Firewall_driver_for_realizing_neutron_security_group_function-2"><span class="toc-number">66.</span> <span class="toc-text">Firewall driver for realizing neutron security group function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#确保RabbitMQ_IP指向了控制节点-1"><span class="toc-number">67.</span> <span class="toc-text">确保RabbitMQ IP指向了控制节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-_Nova"><span class="toc-number">67.1.</span> <span class="toc-text">4.6. Nova</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Workaround_for_https://bugs-launchpad-net/nova/+bug/1154809-1"><span class="toc-number">68.</span> <span class="toc-text">Workaround for https://bugs.launchpad.net/nova/+bug/1154809</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Auth-1"><span class="toc-number">69.</span> <span class="toc-text">Auth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Imaging_service-1"><span class="toc-number">70.</span> <span class="toc-text">Imaging service</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vnc_configuration-1"><span class="toc-number">71.</span> <span class="toc-text">Vnc configuration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Network_settings-1"><span class="toc-number">72.</span> <span class="toc-text">Network settings</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Neutron_+_Nova_Security_groups-1"><span class="toc-number">73.</span> <span class="toc-text">If you want Neutron + Nova Security groups</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#firewall_driver=nova-virt-firewall-NoopFirewallDriver-1"><span class="toc-number">74.</span> <span class="toc-text">firewall_driver=nova.virt.firewall.NoopFirewallDriver</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security_group_api=neutron-1"><span class="toc-number">75.</span> <span class="toc-text">security_group_api=neutron</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Nova_Security_groups_only,_comment_the_two_lines_above_and_uncomment_line_-1--1"><span class="toc-number">76.</span> <span class="toc-text">If you want Nova Security groups only, comment the two lines above and uncomment line -1-.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Metadata-1"><span class="toc-number">77.</span> <span class="toc-text">Metadata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Compute-1"><span class="toc-number">78.</span> <span class="toc-text">Compute</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cinder-2"><span class="toc-number">79.</span> <span class="toc-text">Cinder</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-_结束语"><span class="toc-number">80.</span> <span class="toc-text">5. 结束语</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-_参考文档"><span class="toc-number">81.</span> <span class="toc-text">6. 参考文档</span></a></li></ol>
		
		</div>
		
		<p>==========================================================</p>
<h1 id="OpenStack_Havana_安装指南">  OpenStack Havana 安装指南</h1><p>:Version: 1.0<br>:Source: <a href="https://github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode" target="_blank" rel="external">https://github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode</a><br>:Keywords: 多点OpenStack安装, Havana, Neutron, Nova, Keystone, Glance, Horizon, Cinder, OpenVSwitch, KVM, Ubuntu Server 12.04 (64 bits).</p>
<h1 id="作者">作者</h1><p><code>crAzyli0n &lt;http://xidianpanpei.github.com&gt;</code>_ <a href="&#109;&#x61;&#x69;&#108;&#x74;&#x6f;&#x3a;&#x70;&#97;&#x6e;&#x6e;&#112;&#x65;&#x69;&#64;&#x67;&#109;&#97;&#105;&#108;&#46;&#x63;&#111;&#109;">&#x70;&#97;&#x6e;&#x6e;&#112;&#x65;&#x69;&#64;&#x67;&#109;&#97;&#105;&#108;&#46;&#x63;&#111;&#109;</a></p>
<p>本指南fork自<br><code>Shi Dongliang &lt;https://github.com/ist0ne/OpenStack-Grizzly-Install-Guide-CN&gt;</code><em><br>的git仓库。<br>同时，本指南同时参考<br><code>Bilel Msekni &lt;https://github.com/mseknibilel/OpenStack-Grizzly-Install-Guide&gt;</code></em><br>的git仓库。</p>
<h1 id="内容列表">内容列表</h1><p>::</p>
<ol>
<li>简介</li>
<li>环境搭建</li>
<li>控制节点</li>
<li>网络节点</li>
<li>计算节点</li>
<li>OpenStack使用</li>
<li>参考文档</li>
</ol>
<h1 id="0-_简介">0. 简介</h1><p>OpenStack Havana安装指南旨在让你轻松创建自己的OpenStack云平台。</p>
<p>状态: Stable</p>
<h1 id="1-_环境搭建">1. 环境搭建</h1><p>:节点角色: NICs<br>:控制节点: eth0 (10.10.10.51), eth1 (192.168.100.51)<br>:网络节点: eth0 (10.10.10.52), eth1 (192.168.100.52)<br>:计算节点: eth0 (10.10.10.53), eth1 (192.168.100.53)</p>
<p><strong>注意1:</strong> 你总是可以使用dpkg -s <packagename>确认你使用的是havana软件包(版本: 2013.10)</packagename></p>
<p><strong>注意2:</strong> 这个是当前网络架构</p>
<p>.. image:: <a href="https://raw.github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode/master/KeystoneScripts/neutron.jpg" target="_blank" rel="external">https://raw.github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode/master/KeystoneScripts/neutron.jpg</a></p>
<h1 id="2-_控制节点">2. 控制节点</h1><h2 id="2-1-_准备Ubuntu">2.1. 准备Ubuntu</h2><ul>
<li><p>安装好Ubuntu 12.04 Server 64bits后, 进入sudo模式直到完成本指南::</p>
<p> sudo su -</p>
</li>
<li><p>添加Havana仓库::</p>
<p> apt-get install ubuntu-cloud-keyring python-software-properties software-properties-common python-keyring<br> echo deb <a href="http://ubuntu-cloud.archive.canonical.com/ubuntu" target="_blank" rel="external">http://ubuntu-cloud.archive.canonical.com/ubuntu</a> precise-proposed/havana main &gt;&gt; /etc/apt/sources.list.d/havana.list</p>
</li>
<li><p>升级系统::</p>
<p> apt-get update<br> apt-get upgrade<br> apt-get dist-upgrade</p>
</li>
</ul>
<h2 id="2-2-设置网络">2.2.设置网络</h2><ul>
<li><p>如下编辑网卡配置文件/etc/network/interfaces::</p>
<h1 id="Not_internet_connected(used_for_OpenStack_management)">Not internet connected(used for OpenStack management)</h1><p> auto eth0<br> iface eth0 inet static<br> address 10.10.10.51<br> netmask 255.255.255.0<br> gateway 10.10.10.1</p>
<h1 id="For_Exposing_OpenStack_API_over_the_internet">For Exposing OpenStack API over the internet</h1><p> auto eth1<br> iface eth1 inet static<br> address 192.168.100.51<br> netmask 255.255.255.0<br> gateway 192.168.100.1<br> dns-nameservers 8.8.8.8</p>
</li>
<li><p>重启网络服务::</p>
<p> service networking restart</p>
</li>
<li><p>开启路由转发::</p>
<p> sed -i ‘s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/‘ /etc/sysctl.conf<br> sysctl -p</p>
</li>
</ul>
<h2 id="2-3-_安装MySQL">2.3. 安装MySQL</h2><ul>
<li><p>安装MySQL并为root用户设置密码::</p>
<p> apt-get install -y mysql-server python-mysqldb</p>
</li>
<li><p>配置mysql监听所有网络接口请求::</p>
<p> sed -i ‘s/127.0.0.1/0.0.0.0/g’ /etc/mysql/my.cnf<br> service mysql restart</p>
</li>
</ul>
<h2 id="2-4-_安装RabbitMQ和NTP">2.4. 安装RabbitMQ和NTP</h2><ul>
<li><p>安装RabbitMQ::</p>
<p> apt-get install -y rabbitmq-server</p>
</li>
<li><p>安装NTP服务::</p>
<p> apt-get install -y ntp</p>
</li>
</ul>
<h2 id="2-5-_创建数据库">2.5. 创建数据库</h2><ul>
<li><p>创建数据库::</p>
<p> mysql -u root -p</p>
<h1 id="Keystone">Keystone</h1><p> CREATE DATABASE keystone;<br> GRANT ALL ON keystone.* TO ‘keystoneUser’@’%’ IDENTIFIED BY ‘keystonePass’;</p>
<h1 id="Glance">Glance</h1><p> CREATE DATABASE glance;<br> GRANT ALL ON glance.* TO ‘glanceUser’@’%’ IDENTIFIED BY ‘glancePass’;</p>
<h1 id="Neutron">Neutron</h1><p> CREATE DATABASE neutron;<br> GRANT ALL ON neutron.* TO ‘neutronUser’@’%’ IDENTIFIED BY ‘neutronPass’;</p>
<h1 id="Nova">Nova</h1><p> CREATE DATABASE nova;<br> GRANT ALL ON nova.* TO ‘novaUser’@’%’ IDENTIFIED BY ‘novaPass’;</p>
<h1 id="Cinder">Cinder</h1><p> CREATE DATABASE cinder;<br> GRANT ALL ON cinder.* TO ‘cinderUser’@’%’ IDENTIFIED BY ‘cinderPass’;</p>
<p> quit;</p>
</li>
</ul>
<h2 id="2-6-_配置Keystone">2.6. 配置Keystone</h2><ul>
<li><p>安装keystone软件包::</p>
<p> apt-get install -y keystone</p>
</li>
<li><p>在/etc/keystone/keystone.conf中设置连接到新创建的数据库::</p>
<p> connection = mysql://keystoneUser:keystonePass@10.10.10.51/keystone</p>
</li>
<li><p>重启身份认证服务并同步数据库::</p>
<p> service keystone restart<br> keystone-manage db_sync</p>
</li>
<li><p>使用git仓库中脚本填充keystone数据库： <code>脚本文件夹 &lt;https://github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode/tree/master/KeystoneScripts&gt;</code>_ ::</p>
<h1 id="注意在执行脚本前请按你的网卡配置修改HOST_IP和HOST_IP_EXT">注意在执行脚本前请按你的网卡配置修改HOST_IP和HOST_IP_EXT</h1><p> wget <a href="https://raw.github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode/master/KeystoneScripts/keystone_basic.sh" target="_blank" rel="external">https://raw.github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode/master/KeystoneScripts/keystone_basic.sh</a><br> wget <a href="https://raw.github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode/master/KeystoneScripts/keystone_endpoints_basic.sh" target="_blank" rel="external">https://raw.github.com/xidianpanpei/OpenStack-Havana-Install-Guide-CN-OVS_MutliNode/master/KeystoneScripts/keystone_endpoints_basic.sh</a></p>
<p> chmod +x keystone_basic.sh<br> chmod +x keystone_endpoints_basic.sh</p>
<p> ./keystone_basic.sh<br> ./keystone_endpoints_basic.sh</p>
</li>
<li><p>创建一个简单的凭据文件，这样稍后就不会因为输入过多的环境变量而感到厌烦::</p>
<p> vi creds-admin</p>
<h1 id="Paste_the_following:">Paste the following:</h1><p> export OS_TENANT_NAME=admin<br> export OS_USERNAME=admin<br> export OS_PASSWORD=admin_pass<br> export OS_AUTH_URL=”<a href="http://192.168.100.51:5000/v2.0/" target="_blank" rel="external">http://192.168.100.51:5000/v2.0/</a>“</p>
<h1 id="Load_it:">Load it:</h1><p> source creds-admin</p>
</li>
<li><p>通过命令行列出Keystone中添加的用户::</p>
<p> keystone user-list</p>
</li>
</ul>
<h2 id="2-7-_设置Glance">2.7. 设置Glance</h2><ul>
<li><p>安装Glance::</p>
<p> apt-get install -y glance</p>
</li>
<li><p>按下面更新/etc/glance/glance-api-paste.ini::</p>
<p> [filter:authtoken]<br> paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory<br> delay_auth_decision = true<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = glance<br> admin_password = service_pass</p>
</li>
<li><p>按下面更新/etc/glance/glance-registry-paste.ini::</p>
<p> [filter:authtoken]<br> paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = glance<br> admin_password = service_pass</p>
</li>
<li><p>按下面更新/etc/glance/glance-api.conf::</p>
<p> sql_connection = mysql://glanceUser:glancePass@10.10.10.51/glance</p>
</li>
<li><p>和::</p>
<p> [paste_deploy]<br> flavor = keystone</p>
</li>
<li><p>按下面更新/etc/glance/glance-registry.conf::</p>
<p> sql_connection = mysql://glanceUser:glancePass@10.10.10.51/glance</p>
</li>
<li><p>和::</p>
<p> [paste_deploy]<br> flavor = keystone</p>
</li>
<li><p>重启glance-api和glance-registry服务::</p>
<p> service glance-api restart; service glance-registry restart</p>
</li>
<li><p>同步glance数据库::</p>
<p> glance-manage db_sync</p>
</li>
<li><p>重启服务使配置生效::</p>
<p> service glance-registry restart; service glance-api restart</p>
</li>
<li><p>测试Glance, 从网络上传cirros云镜像::</p>
<p> glance image-create —name cirros —is-public true —container-format bare —disk-format qcow2 —location <a href="https://launchpad.net/cirros/trunk/0.3.0/+download/cirros-0.3.0-x86_64-disk.img" target="_blank" rel="external">https://launchpad.net/cirros/trunk/0.3.0/+download/cirros-0.3.0-x86_64-disk.img</a></p>
<p> 注意：通过此镜像创建的虚拟机可通过用户名/密码登陆， 用户名：cirros 密码：cubswin:)</p>
</li>
<li><p>本地创建Ubuntu云镜像::</p>
<p> wget <a href="http://cloud-images.ubuntu.com/precise/current/precise-server-cloudimg-amd64-disk1.img" target="_blank" rel="external">http://cloud-images.ubuntu.com/precise/current/precise-server-cloudimg-amd64-disk1.img</a><br> glance add name=”Ubuntu 12.04 cloudimg amd64” is_public=true container_format=ovf disk_format=qcow2 &lt; ./precise-server-cloudimg-amd64-disk1.img</p>
</li>
<li><p>列出镜像检查是否上传成功::</p>
<p> glance image-list</p>
</li>
</ul>
<h2 id="2-8-_设置Neutron">2.8. 设置Neutron</h2><ul>
<li><p>安装Neutron组件::</p>
<p> apt-get install -y neutron-server</p>
</li>
<li><p>编辑/etc/neutron/api-paste.ini ::</p>
<p> [filter:authtoken]<br> paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass</p>
</li>
<li><p>编辑OVS配置文件/etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini::</p>
<h1 id="Under_the_database_section">Under the database section</h1><p> [DATABASE]<br> connection = mysql://neutronUser:neutronPass@10.10.10.51/neutron</p>
<h1 id="Under_the_OVS_section">Under the OVS section</h1><p> [OVS]<br> tenant_network_type = gre<br> tunnel_id_ranges = 1:1000<br> enable_tunneling = True</p>
<h1 id="Firewall_driver_for_realizing_neutron_security_group_function">Firewall driver for realizing neutron security group function</h1><p> [SECURITYGROUP]<br> firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver</p>
</li>
<li><p>编辑/etc/neutron/neutron.conf::</p>
<p> [keystone_authtoken]<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass<br> signing_dir = /var/lib/neutron/keystone-signing</p>
</li>
<li><p>重启neutron所有服务::</p>
<p> cd /etc/init.d/; for i in $( ls neutron-* ); do sudo service $i restart; done</p>
</li>
</ul>
<h2 id="2-9-_设置Nova">2.9. 设置Nova</h2><ul>
<li><p>安装nova组件::</p>
<p> apt-get install -y nova-api nova-cert novnc nova-consoleauth nova-scheduler nova-novncproxy nova-doc nova-conductor</p>
</li>
<li><p>在/etc/nova/api-paste.ini配置文件中修改认证信息::</p>
<p> [filter:authtoken]<br> paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = nova<br> admin_password = service_pass<br> signing_dirname = /tmp/keystone-signing-nova</p>
<h1 id="Workaround_for_https://bugs-launchpad-net/nova/+bug/1154809">Workaround for <a href="https://bugs.launchpad.net/nova/+bug/1154809" target="_blank" rel="external">https://bugs.launchpad.net/nova/+bug/1154809</a></h1><p> auth_version = v2.0</p>
</li>
<li><p>如下修改/etc/nova/nova.conf::</p>
<p> [DEFAULT]<br> logdir=/var/log/nova<br> state_path=/var/lib/nova<br> lock_path=/run/lock/nova<br> verbose=True<br> api_paste_config=/etc/nova/api-paste.ini<br> compute_scheduler_driver=nova.scheduler.simple.SimpleScheduler<br> rabbit_host=10.10.10.51<br> nova_url=<a href="http://10.10.10.51:8774/v1.1/" target="_blank" rel="external">http://10.10.10.51:8774/v1.1/</a><br> sql_connection=mysql://novaUser:novaPass@10.10.10.51/nova<br> root_helper=sudo nova-rootwrap /etc/nova/rootwrap.conf</p>
<h1 id="Auth">Auth</h1><p> use_deprecated_auth=false<br> auth_strategy=keystone</p>
<h1 id="Imaging_service">Imaging service</h1><p> glance_api_servers=10.10.10.51:9292<br> image_service=nova.image.glance.GlanceImageService</p>
<h1 id="Vnc_configuration">Vnc configuration</h1><p> novnc_enabled=true<br> novncproxy_base_url=<a href="http://192.168.100.51:6080/vnc_auto.html" target="_blank" rel="external">http://192.168.100.51:6080/vnc_auto.html</a><br> novncproxy_port=6080<br> vncserver_proxyclient_address=10.10.10.51<br> vncserver_listen=0.0.0.0</p>
<h1 id="Network_settings">Network settings</h1><p> network_api_class=nova.network.neutronv2.api.API<br> neutron_url=<a href="http://10.10.10.51:9696" target="_blank" rel="external">http://10.10.10.51:9696</a><br> neutron_auth_strategy=keystone<br> neutron_admin_tenant_name=service<br> neutron_admin_username=neutron<br> neutron_admin_password=service_pass<br> neutron_admin_auth_url=<a href="http://10.10.10.51:35357/v2.0" target="_blank" rel="external">http://10.10.10.51:35357/v2.0</a><br> libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver<br> linuxnet_interface_driver=nova.network.linux_net.LinuxOVSInterfaceDriver</p>
<h1 id="If_you_want_Neutron_+_Nova_Security_groups">If you want Neutron + Nova Security groups</h1><h1 id="firewall_driver=nova-virt-firewall-NoopFirewallDriver">firewall_driver=nova.virt.firewall.NoopFirewallDriver</h1><h1 id="security_group_api=neutron">security_group_api=neutron</h1><h1 id="If_you_want_Nova_Security_groups_only,_comment_the_two_lines_above_and_uncomment_line_-1-">If you want Nova Security groups only, comment the two lines above and uncomment line -1-.</h1><p> firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver</p>
<h1 id="Metadata">Metadata</h1><p> service_neutron_metadata_proxy = True<br> neutron_metadata_proxy_shared_secret = helloOpenStack</p>
<h1 id="Compute">Compute</h1><p> compute_driver=libvirt.LibvirtDriver</p>
<h1 id="Cinder-1">Cinder</h1><p> volume_api_class=nova.volume.cinder.API<br> osapi_volume_listen_port=5900</p>
</li>
<li><p>同步数据库::</p>
<p> nova-manage db sync</p>
</li>
<li><p>重启所有nova服务::</p>
<p> cd /etc/init.d/; for i in $( ls nova-* ); do sudo service $i restart; done</p>
</li>
<li><p>检查所有nova服务是否启动正常::</p>
<p> nova-manage service list</p>
</li>
</ul>
<h2 id="2-10-_设置Cinder">2.10. 设置Cinder</h2><ul>
<li><p>安装软件包::</p>
<p> apt-get install -y cinder-api cinder-scheduler cinder-volume iscsitarget open-iscsi iscsitarget-dkms</p>
</li>
<li><p>配置iscsi服务::</p>
<p> sed -i ‘s/false/true/g’ /etc/default/iscsitarget</p>
</li>
<li><p>重启服务::</p>
<p> service iscsitarget start<br> service open-iscsi start</p>
</li>
<li><p>如下配置/etc/cinder/api-paste.ini::</p>
<p> [filter:authtoken]<br> paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory<br> service_protocol = http<br> service_host = 192.168.100.51<br> service_port = 5000<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = cinder<br> admin_password = service_pass</p>
</li>
<li><p>编辑/etc/cinder/cinder.conf::</p>
<p> [DEFAULT]<br> rootwrap_config=/etc/cinder/rootwrap.conf<br> sql_connection = mysql://cinderUser:cinderPass@10.10.10.51/cinder<br> api_paste_config = /etc/cinder/api-paste.ini<br> iscsi_helper=ietadm<br> volume_name_template = volume-%s<br> volume_group = cinder-volumes<br> verbose = True<br> auth_strategy = keystone</p>
<h1 id="osapi_volume_listen_port=5900">osapi_volume_listen_port=5900</h1></li>
<li><p>接下来同步数据库::</p>
<p> cinder-manage db sync</p>
</li>
<li><p>最后别忘了创建一个卷组命名为cinder-volumes::</p>
<p> dd if=/dev/zero of=cinder-volumes bs=1 count=0 seek=2G<br> losetup /dev/loop2 cinder-volumes<br> fdisk /dev/loop2</p>
<h1 id="Type_in_the_followings:">Type in the followings:</h1><p> n<br> p<br> 1<br> ENTER<br> ENTER<br> t<br> 8e<br> w</p>
</li>
<li><p>创建物理卷和卷组::</p>
<p> pvcreate /dev/loop2<br> vgcreate cinder-volumes /dev/loop2</p>
</li>
</ul>
<p><strong>注意:</strong> 重启后卷组不会自动挂载 (点击<code>这个 &lt;https://github.com/mseknibilel/OpenStack-Folsom-Install-guide/blob/master/Tricks%26Ideas/load_volume_group_after_system_reboot.rst&gt;</code>_ 设置在重启后自动挂载)</p>
<ul>
<li><p>重启cinder服务::</p>
<p> cd /etc/init.d/; for i in $( ls cinder-* ); do sudo service $i restart; done</p>
</li>
<li><p>确认cinder服务在运行::</p>
<p> cd /etc/init.d/; for i in $( ls cinder-* ); do sudo service $i status; done</p>
</li>
</ul>
<h2 id="2-11-_设置Horizon">2.11. 设置Horizon</h2><ul>
<li><p>如下安装horizon ::</p>
<p> apt-get install -y openstack-dashboard memcached</p>
</li>
<li><p>如果你不喜欢OpenStack ubuntu主题, 你可以停用它::</p>
<p> dpkg —purge openstack-dashboard-ubuntu-theme</p>
</li>
<li><p>重启Apache和memcached服务::</p>
<p> service apache2 restart; service memcached restart</p>
</li>
</ul>
<h1 id="3-_网络节点">3. 网络节点</h1><h2 id="3-1-_准备节点">3.1. 准备节点</h2><ul>
<li><p>安装好Ubuntu 12.04 Server 64bits后, 进入sudo模式直到完成本指南::</p>
<p> sudo su -</p>
</li>
<li><p>添加Havana仓库::</p>
<p> apt-get install ubuntu-cloud-keyring python-software-properties software-properties-common python-keyring<br> echo deb <a href="http://ubuntu-cloud.archive.canonical.com/ubuntu" target="_blank" rel="external">http://ubuntu-cloud.archive.canonical.com/ubuntu</a> precise-proposed/havana main &gt;&gt; /etc/apt/sources.list.d/havana.list</p>
</li>
<li><p>升级系统::</p>
<p> apt-get update<br> apt-get upgrade<br> apt-get dist-upgrade</p>
</li>
<li><p>安装ntp服务::</p>
<p> apt-get install -y ntp</p>
</li>
<li><p>配置ntp服务从控制节点同步时间::</p>
<h1 id="Comment_the_ubuntu_NTP_servers">Comment the ubuntu NTP servers</h1><p> sed -i ‘s/server 0.ubuntu.pool.ntp.org/#server 0.ubuntu.pool.ntp.org/g’ /etc/ntp.conf<br> sed -i ‘s/server 1.ubuntu.pool.ntp.org/#server 1.ubuntu.pool.ntp.org/g’ /etc/ntp.conf<br> sed -i ‘s/server 2.ubuntu.pool.ntp.org/#server 2.ubuntu.pool.ntp.org/g’ /etc/ntp.conf<br> sed -i ‘s/server 3.ubuntu.pool.ntp.org/#server 3.ubuntu.pool.ntp.org/g’ /etc/ntp.conf</p>
<h1 id="Set_the_network_node_to_follow_up_your_conroller_node">Set the network node to follow up your conroller node</h1><p> sed -i ‘s/server ntp.ubuntu.com/server 10.10.10.51/g’ /etc/ntp.conf</p>
<p> service ntp restart</p>
</li>
</ul>
<h2 id="3-2-_配置网络">3.2. 配置网络</h2><ul>
<li><p>3块网卡如下设置::</p>
<h1 id="OpenStack_management">OpenStack management</h1><p> auto eth0<br> iface eth0 inet static<br> address 10.10.10.52<br> netmask 255.255.255.0</p>
<h1 id="VM_internet_Access">VM internet Access</h1><p> auto eth1<br> iface eth1 inet static<br> address 192.168.100.52<br> netmask 255.255.255.0</p>
</li>
<li><p>开启路由转发::</p>
<p> sed -i ‘s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/‘ /etc/sysctl.conf<br> sysctl -p</p>
</li>
</ul>
<h2 id="3-3-_OpenVSwitch">3.3. OpenVSwitch</h2><ul>
<li><p>安装OpenVSwitch软件包::</p>
<p> apt-get install -y openvswitch-controller openvswitch-switch openvswitch-datapath-dkms</p>
</li>
<li><p>重新启动openvswitch-switch::</p>
<p> /etc/init.d/openvswitch-switch restart</p>
</li>
<li><p>添加网桥 br-ex 并把网卡 eth1 加入 br-ex::</p>
<p> ovs-vsctl  add-br br-ex<br> ovs-vsctl add-port br-ex eth1</p>
</li>
<li><p>如下编辑/etc/network/interfaces::</p>
<h1 id="This_file_describes_the_network_interfaces_available_on_your_system">This file describes the network interfaces available on your system</h1><h1 id="and_how_to_activate_them-_For_more_information,_see_interfaces(5)-">and how to activate them. For more information, see interfaces(5).</h1><h1 id="The_loopback_network_interface">The loopback network interface</h1><p> auto lo<br> iface lo inet loopback</p>
<h1 id="Not_internet_connected(used_for_OpenStack_management)-1">Not internet connected(used for OpenStack management)</h1><h1 id="The_primary_network_interface">The primary network interface</h1><p> auto eth0<br> iface eth0 inet static</p>
<h1 id="This_is_an_autoconfigured_IPv6_interface">This is an autoconfigured IPv6 interface</h1><h1 id="iface_eth0_inet6_auto">iface eth0 inet6 auto</h1><p> address 10.10.10.52<br> netmask 255.255.255.0</p>
<h1 id="For_Exposing_OpenStack_API_over_the_internet-1">For Exposing OpenStack API over the internet</h1><p> auto eth1<br> iface eth1 inet manual<br> up ifconfig $IFACE 0.0.0.0 up<br> up ip link set $IFACE promisc on<br> down ip link set $IFACE promisc off<br> down ifconfig $IFACE down</p>
<p> auto br-ex<br> iface br-ex inet static<br> address 192.168.100.52<br> netmask 255.255.255.0<br> gateway 192.168.100.1<br> dns-nameservers 8.8.8.8</p>
</li>
<li><p>重启网络服务::</p>
<p> /etc/init.d/networking restart</p>
</li>
<li><p>创建内网网桥br-int::</p>
<p> ovs-vsctl add-br br-int</p>
</li>
<li><p>查看网桥配置::</p>
<p> root@openstack-network:~# ovs-vsctl list-br<br> br-ex<br> br-int</p>
<p> root@openstack-network:~# ovs-vsctl show<br> ebea0b50-e450-41ea-babb-a094ca8d69fa</p>
<pre><code>Bridge <span class="keyword">br</span>-int
    Port <span class="keyword">br</span>-int
        Interface <span class="keyword">br</span>-int
            <span class="keyword">type</span>: internal
Bridge <span class="keyword">br</span>-<span class="keyword">ex</span>
    Port <span class="string">"eth1"</span>
        Interface <span class="string">"eth1"</span>
    Port <span class="keyword">br</span>-<span class="keyword">ex</span>
        Interface <span class="keyword">br</span>-<span class="keyword">ex</span>
            <span class="keyword">type</span>: internal
ovs_version: <span class="string">"1.4.0+build0"</span>
</code></pre></li>
</ul>
<h2 id="3-4-_Neutron-*">3.4. Neutron-*</h2><ul>
<li><p>安装Neutron组件::</p>
<p> apt-get -y install neutron-plugin-openvswitch-agent neutron-dhcp-agent neutron-l3-agent neutron-metadata-agent</p>
</li>
<li><p>编辑/etc/neutron/api-paste.ini ::</p>
<p> [filter:authtoken]<br> paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass</p>
</li>
<li><p>编辑OVS配置文件/etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini::</p>
<h1 id="Under_the_database_section-1">Under the database section</h1><p> [DATABASE]<br> connection = mysql://neutronUser:neutronPass@10.10.10.51/neutron</p>
<h1 id="Under_the_OVS_section-1">Under the OVS section</h1><p> [OVS]<br> tenant_network_type = gre<br> enable_tunneling = True<br> tunnel_id_ranges = 1:1000<br> integration_bridge = br-int<br> tunnel_bridge = br-tun<br> local_ip = 10.10.10.52</p>
<h1 id="Firewall_driver_for_realizing_neutron_security_group_function-1">Firewall driver for realizing neutron security group function</h1><p> [SECURITYGROUP]<br> firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver</p>
</li>
<li><p>更新/etc/neutron/metadata_agent.ini::</p>
<h1 id="The_Neutron_user_information_for_accessing_the_Neutron_API-">The Neutron user information for accessing the Neutron API.</h1><p> auth_url = <a href="http://10.10.10.51:35357/v2.0" target="_blank" rel="external">http://10.10.10.51:35357/v2.0</a><br> auth_region = RegionOne<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass</p>
<h1 id="IP_address_used_by_Nova_metadata_server">IP address used by Nova metadata server</h1><p> nova_metadata_ip = 10.10.10.51</p>
<h1 id="TCP_Port_used_by_Nova_metadata_server">TCP Port used by Nova metadata server</h1><p> nova_metadata_port = 8775</p>
<p> metadata_proxy_shared_secret = helloOpenStack</p>
</li>
<li><p>编辑/etc/neutron/neutron.conf::</p>
<h1 id="确保RabbitMQ_IP指向了控制节点">确保RabbitMQ IP指向了控制节点</h1><p> rabbit_host = 10.10.10.51</p>
<p> [keystone_authtoken]<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass<br> signing_dir = /var/lib/neutron/keystone-signing</p>
<p> [DATABASE]<br> connection = mysql://neutronUser:neutronPass@10.10.10.51/neutron</p>
</li>
<li><p>编辑/etc/neutron/l3_agent.ini::</p>
<p> [DEFAULT]<br> interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver<br> use_namespaces = True<br> external_network_bridge = br-ex<br> signing_dir = /var/cache/neutron<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass<br> auth_url = <a href="http://10.10.10.51:35357/v2.0" target="_blank" rel="external">http://10.10.10.51:35357/v2.0</a><br> l3_agent_manager = neutron.agent.l3_agent.L3NATAgentWithStateReport<br> root_helper = sudo neutron-rootwrap /etc/neutron/rootwrap.conf<br> interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver</p>
</li>
<li><p>编辑/etc/neutron/dhcp_agent.ini::</p>
<p> [DEFAULT]<br> interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver<br> dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq<br> use_namespaces = True<br> signing_dir = /var/cache/neutron<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass<br> auth_url = <a href="http://10.10.10.51:35357/v2.0" target="_blank" rel="external">http://10.10.10.51:35357/v2.0</a><br> dhcp_agent_manager = neutron.agent.dhcp_agent.DhcpAgentWithStateReport<br> root_helper = sudo neutron-rootwrap /etc/neutron/rootwrap.conf<br> state_path = /var/lib/neutron</p>
</li>
<li><p>重启neutron所有服务::</p>
<p> cd /etc/init.d/; for i in $( ls neutron-* ); do sudo service $i restart; done</p>
</li>
</ul>
<h1 id="4-_计算节点">4. 计算节点</h1><h2 id="4-1-_准备节点">4.1. 准备节点</h2><ul>
<li><p>安装好Ubuntu 12.04 Server 64bits后,升级系统并重启之后,进入sudo模式直到完成本指南::</p>
<p> sudo su -</p>
</li>
<li><p>添加Havana仓库::</p>
<p> apt-get install ubuntu-cloud-keyring python-software-properties software-properties-common python-keyring<br> echo deb <a href="http://ubuntu-cloud.archive.canonical.com/ubuntu" target="_blank" rel="external">http://ubuntu-cloud.archive.canonical.com/ubuntu</a> precise-proposed/havana main &gt;&gt; /etc/apt/sources.list.d/havana.list</p>
</li>
<li><p>升级系统::</p>
<p> apt-get update<br> apt-get upgrade<br> apt-get dist-upgrade</p>
</li>
<li><p>安装ntp服务::</p>
<p> apt-get install -y ntp</p>
</li>
<li><p>配置ntp服务从控制节点同步时间::</p>
<h1 id="Comment_the_ubuntu_NTP_servers-1">Comment the ubuntu NTP servers</h1><p> sed -i ‘s/server 0.ubuntu.pool.ntp.org/#server 0.ubuntu.pool.ntp.org/g’ /etc/ntp.conf<br> sed -i ‘s/server 1.ubuntu.pool.ntp.org/#server 1.ubuntu.pool.ntp.org/g’ /etc/ntp.conf<br> sed -i ‘s/server 2.ubuntu.pool.ntp.org/#server 2.ubuntu.pool.ntp.org/g’ /etc/ntp.conf<br> sed -i ‘s/server 3.ubuntu.pool.ntp.org/#server 3.ubuntu.pool.ntp.org/g’ /etc/ntp.conf</p>
<h1 id="Set_the_network_node_to_follow_up_your_conroller_node-1">Set the network node to follow up your conroller node</h1><p> sed -i ‘s/server ntp.ubuntu.com/server 10.10.10.51/g’ /etc/ntp.conf</p>
<p> service ntp restart</p>
</li>
</ul>
<h2 id="4-2-_配置网络">4.2. 配置网络</h2><ul>
<li><p>如下配置网络::</p>
<h1 id="This_file_describes_the_network_interfaces_available_on_your_system-1">This file describes the network interfaces available on your system</h1><h1 id="and_how_to_activate_them-_For_more_information,_see_interfaces(5)--1">and how to activate them. For more information, see interfaces(5).</h1><h1 id="The_loopback_network_interface-1">The loopback network interface</h1><p> auto lo<br> iface lo inet loopback</p>
<h1 id="Not_internet_connected(used_for_OpenStack_management)-2">Not internet connected(used for OpenStack management)</h1><h1 id="The_primary_network_interface-1">The primary network interface</h1><p> auto eth0<br> iface eth0 inet static<br> address 10.10.10.53<br> netmask 255.255.255.0<br> gateway 10.10.10.1</p>
<h1 id="VM_Configuration">VM Configuration</h1><p> auto eth1<br> iface eth1 inet static<br> address 192.168.100.53<br> netmask 255.255.255.0<br> gateway 192.168.100.1</p>
</li>
<li><p>开启路由转发::</p>
<p> sed -i ‘s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/‘ /etc/sysctl.conf<br> sysctl -p</p>
</li>
</ul>
<h2 id="4-3-_KVM">4.3. KVM</h2><ul>
<li><p>确保你的硬件启用virtualization::</p>
<p> apt-get install cpu-checker<br> kvm-ok</p>
</li>
<li><p>现在安装kvm并配置它::</p>
<p> apt-get install -y kvm libvirt-bin pm-utils</p>
</li>
<li><p>在/etc/libvirt/qemu.conf配置文件中启用cgroup_device_acl数组::</p>
<p> cgroup_device_acl = [<br> “/dev/null”, “/dev/full”, “/dev/zero”,<br> “/dev/random”, “/dev/urandom”,<br> “/dev/ptmx”, “/dev/kvm”, “/dev/kqemu”,<br> “/dev/rtc”, “/dev/hpet”,”/dev/net/tun”<br> ]</p>
</li>
<li><p>删除默认的虚拟网桥::</p>
<p> virsh net-destroy default<br> virsh net-undefine default</p>
</li>
<li><p>更新/etc/libvirt/libvirtd.conf配置文件::</p>
<p> listen_tls = 0<br> listen_tcp = 1<br> auth_tcp = “none”</p>
</li>
<li><p>E编辑libvirtd_opts变量在/etc/init/libvirt-bin.conf配置文件中::</p>
<p> env libvirtd_opts=”-d -l”</p>
</li>
<li><p>编辑/etc/default/libvirt-bin文件 ::</p>
<p> libvirtd_opts=”-d -l”</p>
</li>
<li><p>重启libvirt服务使配置生效::</p>
<p> service libvirt-bin restart</p>
</li>
</ul>
<h2 id="4-4-_OpenVSwitch">4.4. OpenVSwitch</h2><ul>
<li><p>安装OpenVSwitch软件包::</p>
<p> apt-get install -y openvswitch-controller openvswitch-switch openvswitch-datapath-dkms</p>
</li>
<li><p>重启openvswitch-switch::</p>
<p> /etc/init.d/openvswitch-switch restart</p>
</li>
<li><p>创建网桥::</p>
<h1 id="br-int_will_be_used_for_VM_integration">br-int will be used for VM integration</h1><p> ovs-vsctl add-br br-int</p>
</li>
</ul>
<h2 id="4-5-_Neutron">4.5. Neutron</h2><ul>
<li><p>安装Neutron openvswitch代理::</p>
<p> apt-get -y install neutron-plugin-openvswitch-agent</p>
</li>
<li><p>编辑OVS配置文件/etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini::</p>
<h1 id="Under_the_database_section-2">Under the database section</h1><p> [DATABASE]<br> connection = mysql://neutronUser:neutronPass@10.10.10.51/neutron</p>
<h1 id="Under_the_OVS_section-2">Under the OVS section</h1><p> [OVS]<br> tenant_network_type = gre<br> tunnel_id_ranges = 1:1000<br> integration_bridge = br-int<br> tunnel_bridge = br-tun<br> local_ip = 10.10.10.53<br> enable_tunneling = True</p>
<h1 id="Firewall_driver_for_realizing_neutron_security_group_function-2">Firewall driver for realizing neutron security group function</h1><p> [SECURITYGROUP]<br> firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver</p>
</li>
<li><p>编辑/etc/neutron/neutron.conf::</p>
<h1 id="确保RabbitMQ_IP指向了控制节点-1">确保RabbitMQ IP指向了控制节点</h1><p> rabbit_host = 10.10.10.51</p>
<p> [keystone_authtoken]<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = neutron<br> admin_password = service_pass<br> signing_dir = /var/lib/neutron/keystone-signing</p>
<p> [DATABASE]<br> connection = mysql://neutronUser:neutronPass@10.10.10.51/neutron</p>
</li>
<li><p>重启neutron openvswitch代理服务::</p>
<p> service neutron-plugin-openvswitch-agent restart</p>
</li>
</ul>
<h2 id="4-6-_Nova">4.6. Nova</h2><ul>
<li><p>安装nova组件::</p>
<p> apt-get install -y nova-compute-kvm</p>
<p> 注意：如果你的宿主机不支持kvm虚拟化，可把nova-compute-kvm换成nova-compute-qemu<br> 同时/etc/nova/nova-compute.conf配置文件中的libvirt_type=qemu</p>
</li>
<li><p>在/etc/nova/api-paste.ini配置文件中修改认证信息::</p>
<p> [filter:authtoken]<br> paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory<br> auth_host = 10.10.10.51<br> auth_port = 35357<br> auth_protocol = http<br> admin_tenant_name = service<br> admin_user = nova<br> admin_password = service_pass<br> signing_dirname = /tmp/keystone-signing-nova</p>
<h1 id="Workaround_for_https://bugs-launchpad-net/nova/+bug/1154809-1">Workaround for <a href="https://bugs.launchpad.net/nova/+bug/1154809" target="_blank" rel="external">https://bugs.launchpad.net/nova/+bug/1154809</a></h1><p> auth_version = v2.0</p>
</li>
<li><p>如下修改/etc/nova/nova.conf::</p>
<p> [DEFAULT]<br> logdir=/var/log/nova<br> state_path=/var/lib/nova<br> lock_path=/run/lock/nova<br> verbose=True<br> api_paste_config=/etc/nova/api-paste.ini<br> compute_scheduler_driver=nova.scheduler.simple.SimpleScheduler<br> rabbit_host=10.10.10.51<br> nova_url=<a href="http://10.10.10.51:8774/v1.1/" target="_blank" rel="external">http://10.10.10.51:8774/v1.1/</a><br> sql_connection=mysql://novaUser:novaPass@10.10.10.51/nova<br> root_helper=sudo nova-rootwrap /etc/nova/rootwrap.conf</p>
<h1 id="Auth-1">Auth</h1><p> use_deprecated_auth=false<br> auth_strategy=keystone</p>
<h1 id="Imaging_service-1">Imaging service</h1><p> glance_api_servers=10.10.10.51:9292<br> image_service=nova.image.glance.GlanceImageService</p>
<h1 id="Vnc_configuration-1">Vnc configuration</h1><p> novnc_enabled=true<br> novncproxy_base_url=<a href="http://192.168.100.51:6080/vnc_auto.html" target="_blank" rel="external">http://192.168.100.51:6080/vnc_auto.html</a><br> novncproxy_port=6080<br> vncserver_proxyclient_address=10.10.10.53<br> vncserver_listen=0.0.0.0</p>
<h1 id="Network_settings-1">Network settings</h1><p> network_api_class=nova.network.neutronv2.api.API<br> neutron_url=<a href="http://10.10.10.51:9696" target="_blank" rel="external">http://10.10.10.51:9696</a><br> neutron_auth_strategy=keystone<br> neutron_admin_tenant_name=service<br> neutron_admin_username=neutron<br> neutron_admin_password=service_pass<br> neutron_admin_auth_url=<a href="http://10.10.10.51:35357/v2.0" target="_blank" rel="external">http://10.10.10.51:35357/v2.0</a><br> libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver<br> linuxnet_interface_driver=nova.network.linux_net.LinuxOVSInterfaceDriver</p>
<h1 id="If_you_want_Neutron_+_Nova_Security_groups-1">If you want Neutron + Nova Security groups</h1><h1 id="firewall_driver=nova-virt-firewall-NoopFirewallDriver-1">firewall_driver=nova.virt.firewall.NoopFirewallDriver</h1><h1 id="security_group_api=neutron-1">security_group_api=neutron</h1><h1 id="If_you_want_Nova_Security_groups_only,_comment_the_two_lines_above_and_uncomment_line_-1--1">If you want Nova Security groups only, comment the two lines above and uncomment line -1-.</h1><p> firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver</p>
<h1 id="Metadata-1">Metadata</h1><p> service_neutron_metadata_proxy = True<br> neutron_metadata_proxy_shared_secret = helloOpenStack</p>
<h1 id="Compute-1">Compute</h1><p> compute_driver=libvirt.LibvirtDriver</p>
<h1 id="Cinder-2">Cinder</h1><p> volume_api_class=nova.volume.cinder.API<br> osapi_volume_listen_port=5900<br> cinder_catalog_info=volume:cinder:internalURL</p>
</li>
<li><p>修改/etc/nova/nova-compute.conf::</p>
<p> [DEFAULT]<br> libvirt_type=kvm<br> compute_driver=libvirt.LibvirtDriver<br> libvirt_ovs_bridge=br-int<br> libvirt_vif_type=ethernet<br> libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver<br> libvirt_use_virtio_for_bridges=True</p>
</li>
<li><p>重启所有nova服务::</p>
<p> cd /etc/init.d/; for i in $( ls nova-* ); do sudo service $i restart; done</p>
</li>
<li><p>检查所有nova服务是否启动正常::</p>
<p> nova-manage service list</p>
</li>
</ul>
<h1 id="5-_结束语">5. 结束语</h1><p>由于项目组需求要求，该搭建教程中没有搭建Havana版本中新添加的Ceilmeter和Heat组件。</p>
<p>通过对Havana版本的搭建可以看到，Havana版本的整个搭建过程相比于Grizzly版本来说，并没有发生很明显的变化，主要是有些参数配置所在文件有所变更。同时，针对使用OpenvSwitch插件，其中原来中文版中的openvswitch-brcompat已经无法匹配Havana版本，因此此部分教程参照了英文版教程更改而来。</p>
<p>ps:在搭建过程中细心真的是非常重要的，否则，经常会因为某个配置错误，导致花费大量时间查错。</p>
<h1 id="6-_参考文档">6. 参考文档</h1><p><code>Boostrapping Open vSwitch and Neutron &lt;https://a248.e.akamai.net/cdn.hpcloudsvc.com/h9f25be84b35c201beea6b13c85876258/prodaw2/Bootstrapping_OVS_neutron--final_20130319.html&gt;</code>_</p>
<p><code>Cisco OpenStack Edition: Folsom Manual Install &lt;http://docwiki.cisco.com/wiki/Cisco_OpenStack_Edition:_Folsom_Manual_Install&gt;</code>_</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Openstack/">Openstack</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Openstack/">Openstack</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2015/09/28/openstack/Openstack_Havana_Install_Guide_MutilNode/" data-title="Openstack_Havana_Install_Guide_MutilNode | 李大辉" data-tsina="1901372893" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/09/09/java/Java的ClassLoader原理/"  title="Java的ClassLoader原理">
 <strong>下一篇：</strong><br/> 
 <span>Java的ClassLoader原理
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/09/28/openstack/Openstack_Havana_Install_Guide_MutilNode/" data-title="Openstack_Havana_Install_Guide_MutilNode" data-url="http://yoursite.com/2015/09/28/openstack/Openstack_Havana_Install_Guide_MutilNode/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenStack_Havana_安装指南"><span class="toc-number">1.</span> <span class="toc-text">  OpenStack Havana 安装指南</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#作者"><span class="toc-number">2.</span> <span class="toc-text">作者</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内容列表"><span class="toc-number">3.</span> <span class="toc-text">内容列表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0-_简介"><span class="toc-number">4.</span> <span class="toc-text">0. 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-_环境搭建"><span class="toc-number">5.</span> <span class="toc-text">1. 环境搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-_控制节点"><span class="toc-number">6.</span> <span class="toc-text">2. 控制节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-_准备Ubuntu"><span class="toc-number">6.1.</span> <span class="toc-text">2.1. 准备Ubuntu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-设置网络"><span class="toc-number">6.2.</span> <span class="toc-text">2.2.设置网络</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Not_internet_connected(used_for_OpenStack_management)"><span class="toc-number">7.</span> <span class="toc-text">Not internet connected(used for OpenStack management)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For_Exposing_OpenStack_API_over_the_internet"><span class="toc-number">8.</span> <span class="toc-text">For Exposing OpenStack API over the internet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-_安装MySQL"><span class="toc-number">8.1.</span> <span class="toc-text">2.3. 安装MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-_安装RabbitMQ和NTP"><span class="toc-number">8.2.</span> <span class="toc-text">2.4. 安装RabbitMQ和NTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-_创建数据库"><span class="toc-number">8.3.</span> <span class="toc-text">2.5. 创建数据库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Keystone"><span class="toc-number">9.</span> <span class="toc-text">Keystone</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Glance"><span class="toc-number">10.</span> <span class="toc-text">Glance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Neutron"><span class="toc-number">11.</span> <span class="toc-text">Neutron</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nova"><span class="toc-number">12.</span> <span class="toc-text">Nova</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cinder"><span class="toc-number">13.</span> <span class="toc-text">Cinder</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-_配置Keystone"><span class="toc-number">13.1.</span> <span class="toc-text">2.6. 配置Keystone</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#注意在执行脚本前请按你的网卡配置修改HOST_IP和HOST_IP_EXT"><span class="toc-number">14.</span> <span class="toc-text">注意在执行脚本前请按你的网卡配置修改HOST_IP和HOST_IP_EXT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Paste_the_following:"><span class="toc-number">15.</span> <span class="toc-text">Paste the following:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Load_it:"><span class="toc-number">16.</span> <span class="toc-text">Load it:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-_设置Glance"><span class="toc-number">16.1.</span> <span class="toc-text">2.7. 设置Glance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-_设置Neutron"><span class="toc-number">16.2.</span> <span class="toc-text">2.8. 设置Neutron</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_database_section"><span class="toc-number">17.</span> <span class="toc-text">Under the database section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_OVS_section"><span class="toc-number">18.</span> <span class="toc-text">Under the OVS section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Firewall_driver_for_realizing_neutron_security_group_function"><span class="toc-number">19.</span> <span class="toc-text">Firewall driver for realizing neutron security group function</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-_设置Nova"><span class="toc-number">19.1.</span> <span class="toc-text">2.9. 设置Nova</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Workaround_for_https://bugs-launchpad-net/nova/+bug/1154809"><span class="toc-number">20.</span> <span class="toc-text">Workaround for https://bugs.launchpad.net/nova/+bug/1154809</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Auth"><span class="toc-number">21.</span> <span class="toc-text">Auth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Imaging_service"><span class="toc-number">22.</span> <span class="toc-text">Imaging service</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vnc_configuration"><span class="toc-number">23.</span> <span class="toc-text">Vnc configuration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Network_settings"><span class="toc-number">24.</span> <span class="toc-text">Network settings</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Neutron_+_Nova_Security_groups"><span class="toc-number">25.</span> <span class="toc-text">If you want Neutron + Nova Security groups</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#firewall_driver=nova-virt-firewall-NoopFirewallDriver"><span class="toc-number">26.</span> <span class="toc-text">firewall_driver=nova.virt.firewall.NoopFirewallDriver</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security_group_api=neutron"><span class="toc-number">27.</span> <span class="toc-text">security_group_api=neutron</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Nova_Security_groups_only,_comment_the_two_lines_above_and_uncomment_line_-1-"><span class="toc-number">28.</span> <span class="toc-text">If you want Nova Security groups only, comment the two lines above and uncomment line -1-.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Metadata"><span class="toc-number">29.</span> <span class="toc-text">Metadata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Compute"><span class="toc-number">30.</span> <span class="toc-text">Compute</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cinder-1"><span class="toc-number">31.</span> <span class="toc-text">Cinder</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-10-_设置Cinder"><span class="toc-number">31.1.</span> <span class="toc-text">2.10. 设置Cinder</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#osapi_volume_listen_port=5900"><span class="toc-number">32.</span> <span class="toc-text">osapi_volume_listen_port=5900</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Type_in_the_followings:"><span class="toc-number">33.</span> <span class="toc-text">Type in the followings:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-11-_设置Horizon"><span class="toc-number">33.1.</span> <span class="toc-text">2.11. 设置Horizon</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-_网络节点"><span class="toc-number">34.</span> <span class="toc-text">3. 网络节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-_准备节点"><span class="toc-number">34.1.</span> <span class="toc-text">3.1. 准备节点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Comment_the_ubuntu_NTP_servers"><span class="toc-number">35.</span> <span class="toc-text">Comment the ubuntu NTP servers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set_the_network_node_to_follow_up_your_conroller_node"><span class="toc-number">36.</span> <span class="toc-text">Set the network node to follow up your conroller node</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-_配置网络"><span class="toc-number">36.1.</span> <span class="toc-text">3.2. 配置网络</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenStack_management"><span class="toc-number">37.</span> <span class="toc-text">OpenStack management</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VM_internet_Access"><span class="toc-number">38.</span> <span class="toc-text">VM internet Access</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-_OpenVSwitch"><span class="toc-number">38.1.</span> <span class="toc-text">3.3. OpenVSwitch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_file_describes_the_network_interfaces_available_on_your_system"><span class="toc-number">39.</span> <span class="toc-text">This file describes the network interfaces available on your system</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and_how_to_activate_them-_For_more_information,_see_interfaces(5)-"><span class="toc-number">40.</span> <span class="toc-text">and how to activate them. For more information, see interfaces(5).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_loopback_network_interface"><span class="toc-number">41.</span> <span class="toc-text">The loopback network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Not_internet_connected(used_for_OpenStack_management)-1"><span class="toc-number">42.</span> <span class="toc-text">Not internet connected(used for OpenStack management)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_primary_network_interface"><span class="toc-number">43.</span> <span class="toc-text">The primary network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_is_an_autoconfigured_IPv6_interface"><span class="toc-number">44.</span> <span class="toc-text">This is an autoconfigured IPv6 interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#iface_eth0_inet6_auto"><span class="toc-number">45.</span> <span class="toc-text">iface eth0 inet6 auto</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For_Exposing_OpenStack_API_over_the_internet-1"><span class="toc-number">46.</span> <span class="toc-text">For Exposing OpenStack API over the internet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-_Neutron-*"><span class="toc-number">46.1.</span> <span class="toc-text">3.4. Neutron-*</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_database_section-1"><span class="toc-number">47.</span> <span class="toc-text">Under the database section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_OVS_section-1"><span class="toc-number">48.</span> <span class="toc-text">Under the OVS section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Firewall_driver_for_realizing_neutron_security_group_function-1"><span class="toc-number">49.</span> <span class="toc-text">Firewall driver for realizing neutron security group function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_Neutron_user_information_for_accessing_the_Neutron_API-"><span class="toc-number">50.</span> <span class="toc-text">The Neutron user information for accessing the Neutron API.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IP_address_used_by_Nova_metadata_server"><span class="toc-number">51.</span> <span class="toc-text">IP address used by Nova metadata server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP_Port_used_by_Nova_metadata_server"><span class="toc-number">52.</span> <span class="toc-text">TCP Port used by Nova metadata server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#确保RabbitMQ_IP指向了控制节点"><span class="toc-number">53.</span> <span class="toc-text">确保RabbitMQ IP指向了控制节点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-_计算节点"><span class="toc-number">54.</span> <span class="toc-text">4. 计算节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-_准备节点"><span class="toc-number">54.1.</span> <span class="toc-text">4.1. 准备节点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Comment_the_ubuntu_NTP_servers-1"><span class="toc-number">55.</span> <span class="toc-text">Comment the ubuntu NTP servers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set_the_network_node_to_follow_up_your_conroller_node-1"><span class="toc-number">56.</span> <span class="toc-text">Set the network node to follow up your conroller node</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-_配置网络"><span class="toc-number">56.1.</span> <span class="toc-text">4.2. 配置网络</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_file_describes_the_network_interfaces_available_on_your_system-1"><span class="toc-number">57.</span> <span class="toc-text">This file describes the network interfaces available on your system</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and_how_to_activate_them-_For_more_information,_see_interfaces(5)--1"><span class="toc-number">58.</span> <span class="toc-text">and how to activate them. For more information, see interfaces(5).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_loopback_network_interface-1"><span class="toc-number">59.</span> <span class="toc-text">The loopback network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Not_internet_connected(used_for_OpenStack_management)-2"><span class="toc-number">60.</span> <span class="toc-text">Not internet connected(used for OpenStack management)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The_primary_network_interface-1"><span class="toc-number">61.</span> <span class="toc-text">The primary network interface</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VM_Configuration"><span class="toc-number">62.</span> <span class="toc-text">VM Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-_KVM"><span class="toc-number">62.1.</span> <span class="toc-text">4.3. KVM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-_OpenVSwitch"><span class="toc-number">62.2.</span> <span class="toc-text">4.4. OpenVSwitch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#br-int_will_be_used_for_VM_integration"><span class="toc-number">63.</span> <span class="toc-text">br-int will be used for VM integration</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-_Neutron"><span class="toc-number">63.1.</span> <span class="toc-text">4.5. Neutron</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_database_section-2"><span class="toc-number">64.</span> <span class="toc-text">Under the database section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Under_the_OVS_section-2"><span class="toc-number">65.</span> <span class="toc-text">Under the OVS section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Firewall_driver_for_realizing_neutron_security_group_function-2"><span class="toc-number">66.</span> <span class="toc-text">Firewall driver for realizing neutron security group function</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#确保RabbitMQ_IP指向了控制节点-1"><span class="toc-number">67.</span> <span class="toc-text">确保RabbitMQ IP指向了控制节点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-_Nova"><span class="toc-number">67.1.</span> <span class="toc-text">4.6. Nova</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Workaround_for_https://bugs-launchpad-net/nova/+bug/1154809-1"><span class="toc-number">68.</span> <span class="toc-text">Workaround for https://bugs.launchpad.net/nova/+bug/1154809</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Auth-1"><span class="toc-number">69.</span> <span class="toc-text">Auth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Imaging_service-1"><span class="toc-number">70.</span> <span class="toc-text">Imaging service</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vnc_configuration-1"><span class="toc-number">71.</span> <span class="toc-text">Vnc configuration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Network_settings-1"><span class="toc-number">72.</span> <span class="toc-text">Network settings</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Neutron_+_Nova_Security_groups-1"><span class="toc-number">73.</span> <span class="toc-text">If you want Neutron + Nova Security groups</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#firewall_driver=nova-virt-firewall-NoopFirewallDriver-1"><span class="toc-number">74.</span> <span class="toc-text">firewall_driver=nova.virt.firewall.NoopFirewallDriver</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security_group_api=neutron-1"><span class="toc-number">75.</span> <span class="toc-text">security_group_api=neutron</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If_you_want_Nova_Security_groups_only,_comment_the_two_lines_above_and_uncomment_line_-1--1"><span class="toc-number">76.</span> <span class="toc-text">If you want Nova Security groups only, comment the two lines above and uncomment line -1-.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Metadata-1"><span class="toc-number">77.</span> <span class="toc-text">Metadata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Compute-1"><span class="toc-number">78.</span> <span class="toc-text">Compute</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cinder-2"><span class="toc-number">79.</span> <span class="toc-text">Cinder</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-_结束语"><span class="toc-number">80.</span> <span class="toc-text">5. 结束语</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-_参考文档"><span class="toc-number">81.</span> <span class="toc-text">6. 参考文档</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Hibernate/" title="Hibernate">Hibernate<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/JVM/" title="JVM">JVM<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java集合/" title="Java集合">Java集合<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/Junit/" title="Junit">Junit<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Maven/" title="Maven">Maven<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Openstack/" title="Openstack">Openstack<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/RESTful/" title="RESTful">RESTful<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Spring/" title="Spring">Spring<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/SpringMVC/" title="SpringMVC">SpringMVC<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/密码加密/" title="密码加密">密码加密<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>12</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/Java集合/" title="Java集合">Java集合<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/关系映射/" title="关系映射">关系映射<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/JVM/" title="JVM">JVM<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Spring/" title="Spring">Spring<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/检索策略/" title="检索策略">检索策略<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/AOP/" title="AOP">AOP<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/事务/" title="事务">事务<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SpringMVC/" title="SpringMVC">SpringMVC<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/加密/" title="加密">加密<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Clone/" title="Clone">Clone<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/加盐/" title="加盐">加盐<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Openstack/" title="Openstack">Openstack<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/RESTful/" title="RESTful">RESTful<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/数据库/" title="数据库">数据库<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Mysql/" title="Mysql">Mysql<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Junit/" title="Junit">Junit<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Mocks/" title="Mocks">Mocks<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://blog.csdn.net/tracyhuixingfu一个面向程序员交流分享的新一代社区" target="_blank" title="李辉的CSDN博客">李辉的CSDN博客</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/tracylihui" target="_blank" title="Github">Github</a>
            
          </li>
        
          <li>
            
            	<a href="http://tmaczhao.cn/" target="_blank" title="Drm.for PMonkey">Drm.for PMonkey</a>
            
          </li>
        
    </ul>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1901372893&verifier=cbe23457&dpc=1"></iframe>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m a little programmer. <br/>
			But I believe I can change the world.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1901372893" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/tracylihui" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="Ｔracylihui">Ｔracylihui</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"lihui"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F03a3d7014b8737cea96d5197e4ac5fd0' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
